<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Visualization - {{ project_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .node {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Code Visualization</h1>
            <p class="text-gray-600">Project: {{ project_name }}</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="mb-8">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8">
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 active" data-tab="overview">
                        Overview
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="dependencies">
                        Dependencies
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="components">
                        Components
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="metrics">
                        Metrics
                    </button>
                </nav>
            </div>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">Project Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-medium text-gray-700 mb-2">Files Processed</h3>
                        <p class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-medium text-gray-700 mb-2">Code Files</h3>
                        <p class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-medium text-gray-700 mb-2">Dependencies Found</h3>
                        <p class="text-2xl font-bold text-purple-600">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Analysis Summary</h2>
                <div class="prose max-w-none">
                    <p>Your codebase has been successfully analyzed. The visualization tools below will help you understand the structure, dependencies, and potential improvements for your project.</p>
                    <p>Select different tabs above to explore various aspects of your codebase:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li><strong>Dependencies:</strong> View module dependencies and potential circular dependencies</li>
                        <li><strong>Components:</strong> Explore the architectural components of your system</li>
                        <li><strong>Metrics:</strong> Review code quality metrics and potential issues</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Dependencies Tab -->
        <div id="dependencies" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">Dependency Graph</h2>
                <div id="dependency-graph-container" class="border border-gray-200 rounded-lg h-96 flex items-center justify-center">
                    <div class="text-center">
                        <p class="text-gray-500 mb-4">Generating dependency graph...</p>
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Dependency Analysis</h2>
                <div class="prose max-w-none">
                    <p>This visualization shows the dependencies between different modules in your codebase. Arrows indicate the direction of dependencies.</p>
                    <p>Look for:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li><strong>Circular dependencies:</strong> These can cause maintenance issues</li>
                        <li><strong>Highly connected modules:</strong> These may be doing too much and could be candidates for refactoring</li>
                        <li><strong>Isolated modules:</strong> These may be utility functions or could be dead code</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Components Tab -->
        <div id="components" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">Component Diagram</h2>
                <div id="component-diagram-container" class="border border-gray-200 rounded-lg h-96 flex items-center justify-center">
                    <div class="text-center">
                        <p class="text-gray-500 mb-4">Generating component diagram...</p>
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Architecture Information</h2>
                <div class="prose max-w-none">
                    <p>This diagram shows the architectural components of your system. Rectangles represent files, ovals represent classes, and boxes represent functions.</p>
                    <p>Look for:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li><strong>Large components:</strong> These may be doing too much and could be candidates for decomposition</li>
                        <li><strong>Loosely connected components:</strong> These are good candidates for modularization</li>
                        <li><strong>Tightly coupled components:</strong> These may indicate areas where refactoring could improve maintainability</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Metrics Tab -->
        <div id="metrics" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">Code Metrics</h2>
                <div id="metrics-container" class="border border-gray-200 rounded-lg p-4">
                    <div class="text-center">
                        <p class="text-gray-500 mb-4">Calculating code metrics...</p>
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto"></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Quality Insights</h2>
                <div class="prose max-w-none">
                    <p>Code metrics provide quantitative measures of your code quality:</p>
                    <ul class="list-disc pl-5 mt-2">
                        <li><strong>Cyclomatic Complexity:</strong> Measures the number of linearly independent paths through code</li>
                        <li><strong>Coupling:</strong> Measures the degree of interdependence between software modules</li>
                        <li><strong>Dead Code:</strong> Identifies potentially unused functions or classes</li>
                    </ul>
                    <p>High complexity or coupling values may indicate areas that need refactoring for better maintainability.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Show corresponding content
                    const tabId = button.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Load visualization for the selected tab
                    if (tabId === 'dependencies') {
                        loadDependencyGraph();
                    } else if (tabId === 'components') {
                        loadComponentDiagram();
                    } else if (tabId === 'metrics') {
                        loadMetrics();
                    }
                });
            });
        });
        
        // Visualization functions
        function loadDependencyGraph() {
            const container = document.getElementById('dependency-graph-container');
            container.innerHTML = '<div class="text-center"><p class="text-gray-500 mb-4">Generating dependency graph...</p><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div></div>';
            
            // Simulate loading delay
            setTimeout(() => {
                // Create a simple D3.js force-directed graph
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                // Clear container
                container.innerHTML = '';
                
                // Create SVG
                const svg = d3.select('#dependency-graph-container')
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height);
                
                // Sample data for demonstration
                const nodes = [
                    { id: 'main.py', group: 1 },
                    { id: 'utils.py', group: 2 },
                    { id: 'models.py', group: 3 },
                    { id: 'views.py', group: 4 },
                    { id: 'settings.py', group: 5 },
                    { id: 'api.py', group: 6 },
                    { id: 'database.py', group: 7 }
                ];
                
                const links = [
                    { source: 'main.py', target: 'utils.py' },
                    { source: 'main.py', target: 'models.py' },
                    { source: 'views.py', target: 'models.py' },
                    { source: 'views.py', target: 'utils.py' },
                    { source: 'settings.py', target: 'main.py' },
                    { source: 'api.py', target: 'views.py' },
                    { source: 'api.py', target: 'models.py' },
                    { source: 'database.py', target: 'models.py' }
                ];
                
                // Create links
                const link = svg.append('g')
                    .selectAll('line')
                    .data(links)
                    .enter()
                    .append('line')
                    .attr('class', 'link')
                    .attr('stroke-width', 2);
                
                // Create nodes
                const node = svg.append('g')
                    .selectAll('circle')
                    .data(nodes)
                    .enter()
                    .append('circle')
                    .attr('class', 'node')
                    .attr('r', 15)
                    .attr('fill', d => {
                        switch(d.group) {
                            case 1: return '#ff6b6b';
                            case 2: return '#4ecdc4';
                            case 3: return '#45b7d1';
                            case 4: return '#96ceb4';
                            case 5: return '#feca57';
                            case 6: return '#a061d1';
                            case 7: return '#ff9ff3';
                            default: return '#ddd';
                        }
                    })
                    .call(d3.drag()
                        .on('start', dragstarted)
                        .on('drag', dragged)
                        .on('end', dragended));
                
                // Add labels
                const label = svg.append('g')
                    .selectAll('text')
                    .data(nodes)
                    .enter()
                    .append('text')
                    .text(d => d.id)
                    .attr('font-size', '10px')
                    .attr('dx', 18)
                    .attr('dy', 4);
                
                // Simulation
                const simulation = d3.forceSimulation(nodes)
                    .force('link', d3.forceLink(links).id(d => d.id).distance(100))
                    .force('charge', d3.forceManyBody().strength(-300))
                    .force('center', d3.forceCenter(width / 2, height / 2));
                
                simulation.on('tick', () => {
                    link
                        .attr('x1', d => d.source.x)
                        .attr('y1', d => d.source.y)
                        .attr('x2', d => d.target.x)
                        .attr('y2', d => d.target.y);
                    
                    node
                        .attr('cx', d => d.x)
                        .attr('cy', d => d.y);
                    
                    label
                        .attr('x', d => d.x)
                        .attr('y', d => d.y);
                });
                
                function dragstarted(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }
                
                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }
                
                function dragended(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }
            }, 1000);
        }
        
        function loadComponentDiagram() {
            const container = document.getElementById('component-diagram-container');
            container.innerHTML = '<div class="text-center"><p class="text-gray-500 mb-4">Generating component diagram...</p><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"></div>